(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{92335:function(e,t,o){Promise.resolve().then(o.bind(o,77732)),Promise.resolve().then(o.t.bind(o,96256,23)),Promise.resolve().then(o.t.bind(o,71031,23)),Promise.resolve().then(o.t.bind(o,97315,23)),Promise.resolve().then(o.t.bind(o,65786,23)),Promise.resolve().then(o.t.bind(o,13775,23)),Promise.resolve().then(o.t.bind(o,14571,23)),Promise.resolve().then(o.t.bind(o,685,23)),Promise.resolve().then(o.t.bind(o,67733,23))},77732:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return F}});var r=o(9268);o(86006);var n=o(335),s=o(46372),a=o(42505),i=o(94690);let l={userlist:[],isLoading:!1,error:null},E={isLoading:!1,isError:null,isLoggedin:!1},c=(0,i.UY)({mainReducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_USER_DETAILS_REQUEST":case"UPDATE_USER_DETAILS_REQUEST":case"DELETE_USER_DETAILS_REQUEST":return{...e,isLoading:!0};case"GET_USER_DETAILS_SUCCESS":return console.log("calling grtsuccess"),{...e,userlist:t.payload};case"GET_USER_DETAILS_ERROR":case"SET_USER_DETAILS_ERROR":case"UPDATE_USER_DETAILS_ERROR":case"DELETE_USER_DETAILS_ERROR":return{...e,error:t.payload};case"SET_USER_DETAILS_REQUEST":return console.log("calling reducer set"),{...e,isLoading:!0};case"SET_USER_DETAILS_SUCCESS":return console.log("calling setsuccess"),{...e,userlist:[...e.userlist,t.payload]};case"UPDATE_USER_DETAILS_SUCCESS":let o=[...e.userlist];return o=o.filter(e=>e.id!==t.payload.id),{...e,userlist:[...o,t.payload]};case"DELETE_USER_DETAILS_SUCCESS":let r=[...e.userlist];return r=r.filter(e=>e.id!==t.payload.id),{...e,userlist:[...r]};default:return e}},loginReducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_USER_REGISTER_REQUEST":case"GET_USER_LOGIN_REQUEST":return{...e,isLoading:!0};case"GET_USER_REGISTER_SUCCESS":case"GET_USER_LOGIN_SUCCESS":return{...e,isLoggedin:!0,isLoading:!1};case"GET_USER_REGISTER_ERROR":case"GET_USER_LOGIN_ERROR":return{...e,isError:t.payload};default:return e}}});var S=o(73880),d=o(70212);let T=(e,t)=>{let o=new Date;o.setTime(o.getTime()+1e3*t);let r=JSON.stringify({token:e,expires:o});(0,d.setCookie)(null,"accessToken",r,{expires:o,path:"/"})},y=()=>{let e=(0,d.parseCookies)(),t=e.accessToken;return t||null},_=(e,t)=>{let o=new Date;o.setTime(o.getTime()+1e3*t);let r=JSON.stringify({token:e,expires:o});(0,d.setCookie)(null,"refreshToken",r,{expires:o,path:"/"})},R=()=>{let{refreshToken:e,refreshTokenExpires:t}=(0,d.parseCookies)();return e&&t?{token:e,expires:new Date(t)}:null},p=()=>{(0,d.destroyCookie)(null,"accessToken")},u=()=>{(0,d.destroyCookie)(null,"refreshToken")},h=async e=>{try{let t=await fetch("https://attendanceapi.suktas.com/api/TokenAuth/Authenticate",{method:"POST",headers:{accept:"text/plain","Content-Type":"application/json-patch+json","X-XSRF-TOKEN":"null"},body:JSON.stringify(e)});if(!t.ok)throw Error("Invalid credentials");let o=await t.json(),{accessToken:r,refreshToken:n,expireInSeconds:s,refreshTokenExpireInSeconds:a}=o.result;return{accessToken:r,refreshToken:n,expireInSeconds:s,refreshTokenExpireInSeconds:a}}catch(e){throw Error("Authentication failed")}},g=async()=>{p(),u()},U=async e=>{let t=e?{refreshToken:e}:{refreshToken:R()};console.log("calling newaccess",R());let o=await fetch("https://attendanceapi.suktas.com/api/TokenAuth/RefreshToken",{method:"POST",headers:{accept:"text/plain","X-XSRF-TOKEN":"null"},body:JSON.stringify(t)}),r=await o.json();console.log("calling token",r),T(r.accessToken),localStorage.setItem("accessTokenExpiry",expireInSeconds),console.log("calling newaccess",r)},f=async e=>{if(!e)return!0;let t=new Date(Date.now());return t.setSeconds(t.getSeconds()+e),t<=Date.now()};var I={login:async e=>{try{let{accessToken:t,refreshToken:o,expireInSeconds:r,refreshTokenExpireInSeconds:n}=await h(e);return T(t,r),_(o,n),localStorage.setItem("accessTokenExpiry",r),localStorage.setItem("refreshTokenExpiry",n),!0}catch(e){throw Error("Login failed")}},logout:async()=>{try{return await g(),!0}catch(e){throw Error("Logout failed")}},refreshToken:async()=>{try{return await U(value),!0}catch(e){throw Error("Token refresh failed")}},isAccessTokenExpired:async()=>{try{console.log("calling accesstokenResult before localstorege",y())}catch(e){throw Error("Token fetch failed")}},isRefreshTokenExpired:async()=>{try{let e=await f(localStorage.getItem("refreshTokenExpiry"));return e}catch(e){throw Error("Token fetch failed")}}},L=o(65953);let k=L.Z.create({baseURL:"https://dummyjson.com"}),m=y(),D=R();k.interceptors.request.use(async e=>{let{token:t,expires:o}=JSON.parse(m);return m&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),k.interceptors.response.use(e=>e,async e=>{let t=e.config;if(I.isAccessTokenExpired()){if(t._retry=!0,D)try{let{token:e,exipry:o}=JSON.parse(D),{}=I.refreshToken();return T(m,D,expiresIn),t.headers.Authorization="Bearer ".concat(m),k(t)}catch(e){clearTokensFromCookies()}else clearTokensFromCookies()}return Promise.reject(e)});let A=async()=>await k("/users").then(e=>e.json()),C=async e=>await fetch("https://dummyjson.com/users/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:e,lastName:"Ovi",age:250})}).then(e=>e.json()),O=async e=>await fetch("https://dummyjson.com/users/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:e.name})}).then(e=>e.json()),G=async e=>await fetch("https://dummyjson.com/users/".concat(e),{method:"DELETE"}).then(e=>e.json()),w=async e=>await fetch("https://localhost:7020/api/User/Register",{method:"POST",headers:{accept:"*/*","Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()),b=async e=>await fetch("https://localhost:7020/api/User/Authenticate",{method:"POST",headers:{accept:"*/*","Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json());function*N(){try{yield(0,S.gz)({type:"GET_USER_DETAILS_REQUEST"});let e=yield(0,S.RE)(A);yield(0,S.gz)({type:"GET_USER_DETAILS_SUCCESS",payload:e.users})}catch(e){yield(0,S.gz)({type:"GET_USER_DETAILS_ERROR",payload:e})}}function*P(e){try{yield(0,S.gz)({type:"SET_USER_DETAILS_REQUEST"});let t=yield(0,S.RE)(C,e.payload);yield(0,S.gz)({type:"SET_USER_DETAILS_SUCCESS",payload:t})}catch(e){yield(0,S.gz)({type:"SET_USER_DETAILS_ERROR",payload:e})}}function*x(e){try{yield(0,S.gz)({type:"UPDATE_USER_DETAILS_REQUEST"});let t=yield(0,S.RE)(O,e.payload);yield(0,S.gz)({type:"UPDATE_USER_DETAILS_SUCCESS",payload:t})}catch(e){console.log("error occured",e),yield(0,S.gz)({type:"UPDATE_USER_DETAILS_ERROR",payload:e})}}function*j(e){try{yield(0,S.gz)({type:"DELETE_USER_DETAILS_REQUEST"});let t=yield(0,S.RE)(G,e.payload);yield(0,S.gz)({type:"DELETE_USER_DETAILS_SUCCESS",payload:t})}catch(e){console.log("error occured",e),yield(0,S.gz)({type:"DELETE_USER_DETAILS_ERROR",payload:e})}}function*v(e){try{yield(0,S.gz)({type:"GET_USER_REGISTER_REQUEST"});let t=yield(0,S.RE)(w,e.payload);console.log("calling register result",t),yield(0,S.gz)({type:"GET_USER_REGISTER_SUCCESS",payload:t})}catch(e){console.log("error occured",e),yield(0,S.gz)({type:"GET_USER_REGISTER_ERROR",payload:e})}}function*z(e){try{yield(0,S.gz)({type:"GET_USER_LOGIN_REQUEST"});let t=yield(0,S.RE)(b,e.payload);localStorage.setItem("accessToken",t.accessToken),localStorage.setItem("refreshToken",t.refreshToken),yield(0,S.gz)({type:"GET_USER_LOGIN_SUCCESS",payload:t})}catch(e){console.log("error occured",e),yield(0,S.gz)({type:"GET_USER_LOGIN_ERROR",payload:e})}}let Q=(0,a.ZP)(),J=(0,s.xC)({reducer:c,middleware:()=>[Q]});Q.run(function*(){yield(0,S.ib)("GET_USER_DETAILS",N),yield(0,S.ib)("SET_USER_DETAILS",P),yield(0,S.ib)("UPDATE_USER_DETAILS",x),yield(0,S.ib)("DELETE_USER_DETAILS",j),yield(0,S.ib)("GET_USER_REGISTER",v),yield(0,S.ib)("GET_USER_LOGIN",z)});var F=e=>{let{children:t}=e;return(0,r.jsx)(n.zt,{store:J,children:t})}},67733:function(){}},function(e){e.O(0,[7062,9253,2961,1744],function(){return e(e.s=92335)}),_N_E=e.O()}]);